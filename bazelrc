build --cxxopt=-std=c++17
build --features=-use_header_modules
build --macos_minimum_os=10.15
build --@curl//:http_only=False
build --@curl//:use_mbedtls=True
build --cxxopt="-Wall" --cxxopt="-Wextra" --cxxopt="-Werror"
build --cxxopt="-Werror=unused-function"
build --cxxopt="-O2"


# 2. Apply hardening ONLY to your local workspace code
# The regex ^// matches targets starting with // (your code)

# 3. Apply the same logic to your -Werror flags (Line 6-7)
# This prevents external code warnings from breaking your build

# 3. Handle the "Unused Argument" error for Clang
# This must come BEFORE the specific flags to ensure Clang doesn't choke on GCC flags
build --cxxopt="-Wno-unused-command-line-argument"


#build:clang --cxxopt="-fstack-clash-protection" # Only if using Clang 11+
# If Clang version varies, keep -Wno-unused-command-line-argument enabled (Line 16)

# 5. Sanitizers (Common flags)
build:asan --cxxopt="-fsanitize=address" --linkopt="-fsanitize=address" --cxxopt="-fno-omit-frame-pointer"
test:asan --cxxopt="-fsanitize=address" --linkopt="-fsanitize=address" --cxxopt="-fno-omit-frame-pointer"

build:ubsan --cxxopt="-fsanitize=undefined" --linkopt="-fsanitize=undefined"
test:ubsan --cxxopt="-fsanitize=undefined" --linkopt="-fsanitize=undefined"


build --test_output=errors
