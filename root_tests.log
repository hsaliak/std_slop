Computing main repo mapping: 
Loading: 
Loading: 0 packages loaded
Analyzing: 9 targets (0 packages loaded, 0 targets configured)
Analyzing: 9 targets (0 packages loaded, 0 targets configured)

INFO: Analyzed 9 targets (0 packages loaded, 0 targets configured).
FAIL: //:database_test (Exit 1) (see /private/var/tmp/_bazel_kailashs/99db4ea768af096d4b040886f889832a/execroot/_main/bazel-out/darwin_arm64-fastbuild/testlogs/database_test/test.log)
INFO: From Testing //:database_test:
==================== Test output for //:database_test:
Running main() from gmock_main.cc
[==========] Running 9 tests from 1 test suite.
[----------] Global test environment set-up.
[----------] 9 tests from DatabaseTest
[ RUN      ] DatabaseTest.InitWorks
[       OK ] DatabaseTest.InitWorks (1 ms)
[ RUN      ] DatabaseTest.TablesExist
database_test.cpp:17: Failure
Value of: db.Execute("INSERT INTO messages (session_id, role, content) VALUES ('session1', 'user', 'hello')").ok()
  Actual: false
Expected: true

[  FAILED  ] DatabaseTest.TablesExist (1 ms)
[ RUN      ] DatabaseTest.MessagePersistence
database_test.cpp:24: Failure
Value of: db.AppendMessage("s1", "user", "Hello").ok()
  Actual: false
Expected: true

[  FAILED  ] DatabaseTest.MessagePersistence (1 ms)
[ RUN      ] DatabaseTest.SkillsPersistence
[       OK ] DatabaseTest.SkillsPersistence (0 ms)
[ RUN      ] DatabaseTest.ContextSettingsPersistence
database_test.cpp:63: Failure
Expected equality of these values:
  settings->size
    Which is: 0
  15

[  FAILED  ] DatabaseTest.ContextSettingsPersistence (0 ms)
[ RUN      ] DatabaseTest.GenericQuery
[       OK ] DatabaseTest.GenericQuery (0 ms)
[ RUN      ] DatabaseTest.UsageTracking
database_test.cpp:83: Failure
Value of: db.RecordUsage("s1", "model-a", 10, 20).ok()
  Actual: false
Expected: true

[  FAILED  ] DatabaseTest.UsageTracking (1 ms)
[ RUN      ] DatabaseTest.UpdateMessageStatusWorks
database_test.cpp:104: Failure
Value of: db.AppendMessage("s1", "user", "Hello").ok()
  Actual: false
Expected: true

[  FAILED  ] DatabaseTest.UpdateMessageStatusWorks (0 ms)
[ RUN      ] DatabaseTest.DeleteSessionWorks
database_test.cpp:128: Failure
Value of: db.AppendMessage(sid, "user", "hi").ok()
  Actual: false
Expected: true

[  FAILED  ] DatabaseTest.DeleteSessionWorks (0 ms)
[----------] 9 tests from DatabaseTest (8 ms total)

[----------] Global test environment tear-down
[==========] 9 tests from 1 test suite ran. (9 ms total)
[  PASSED  ] 3 tests.
[  FAILED  ] 6 tests, listed below:
[  FAILED  ] DatabaseTest.TablesExist
[  FAILED  ] DatabaseTest.MessagePersistence
[  FAILED  ] DatabaseTest.ContextSettingsPersistence
[  FAILED  ] DatabaseTest.UsageTracking
[  FAILED  ] DatabaseTest.UpdateMessageStatusWorks
[  FAILED  ] DatabaseTest.DeleteSessionWorks

 6 FAILED TESTS
================================================================================
FAIL: //:input_parsing_test (Exit 1) (see /private/var/tmp/_bazel_kailashs/99db4ea768af096d4b040886f889832a/execroot/_main/bazel-out/darwin_arm64-fastbuild/testlogs/input_parsing_test/test.log)
INFO: From Testing //:input_parsing_test:
==================== Test output for //:input_parsing_test:
Running main() from gmock_main.cc
[==========] Running 4 tests from 1 test suite.
[----------] Global test environment set-up.
[----------] 4 tests from InputParsingTest
[ RUN      ] InputParsingTest.SquareBracesInNormalInput
[       OK ] InputParsingTest.SquareBracesInNormalInput (0 ms)
[ RUN      ] InputParsingTest.SquareBracesInCommandArgs
Current session: test_session
Usage: /session [list|new <name>|switch <name>|remove <name>]
input_parsing_test.cpp:36: Failure
Expected equality of these values:
  session_id
    Which is: "test_session"
  "session[1]"

[  FAILED  ] InputParsingTest.SquareBracesInCommandArgs (1 ms)
[ RUN      ] InputParsingTest.SingleQuotesInCommandArgs
Current session: test_session
Usage: /session [list|new <name>|switch <name>|remove <name>]
input_parsing_test.cpp:46: Failure
Expected equality of these values:
  session_id
    Which is: "test_session"
  "session' OR '1'='1"

[  FAILED  ] InputParsingTest.SingleQuotesInCommandArgs (0 ms)
[ RUN      ] InputParsingTest.MalformedCommand
[       OK ] InputParsingTest.MalformedCommand (0 ms)
[----------] 4 tests from InputParsingTest (3 ms total)

[----------] Global test environment tear-down
[==========] 4 tests from 1 test suite ran. (3 ms total)
[  PASSED  ] 2 tests.
[  FAILED  ] 2 tests, listed below:
[  FAILED  ] InputParsingTest.SquareBracesInCommandArgs
[  FAILED  ] InputParsingTest.SingleQuotesInCommandArgs

 2 FAILED TESTS
================================================================================
FAIL: //:orchestrator_test (Exit 1) (see /private/var/tmp/_bazel_kailashs/99db4ea768af096d4b040886f889832a/execroot/_main/bazel-out/darwin_arm64-fastbuild/testlogs/orchestrator_test/test.log)
FAIL: //:command_handler_test (Exit 1) (see /private/var/tmp/_bazel_kailashs/99db4ea768af096d4b040886f889832a/execroot/_main/bazel-out/darwin_arm64-fastbuild/testlogs/command_handler_test/test.log)
INFO: From Testing //:orchestrator_test:
==================== Test output for //:orchestrator_test:
Running main() from gmock_main.cc
[==========] Running 21 tests from 1 test suite.
[----------] Global test environment set-up.
[----------] 21 tests from OrchestratorTest
[ RUN      ] OrchestratorTest.AssemblePromptBasic
orchestrator_test.cpp:20: Failure
Value of: db.AppendMessage("s1", "user", "Hello").ok()
  Actual: false
Expected: true

[  FAILED  ] OrchestratorTest.AssemblePromptBasic (7 ms)
[ RUN      ] OrchestratorTest.AssemblePromptWithSkills
orchestrator_test.cpp:38: Failure
Value of: db.AppendMessage("s1", "user", "Hello").ok()
  Actual: false
Expected: true

[  FAILED  ] OrchestratorTest.AssemblePromptWithSkills (2 ms)
[ RUN      ] OrchestratorTest.ProcessResponsePersists
orchestrator_test.cpp:59: Failure
Value of: orchestrator.ProcessResponse("s1", mock_response).ok()
  Actual: false
Expected: true

[  FAILED  ] OrchestratorTest.ProcessResponsePersists (2 ms)
[ RUN      ] OrchestratorTest.ProcessResponseToolCall
orchestrator_test.cpp:84: Failure
Value of: orchestrator.ProcessResponse("s1", mock_response).ok()
  Actual: false
Expected: true

[  FAILED  ] OrchestratorTest.ProcessResponseToolCall (1 ms)
[ RUN      ] OrchestratorTest.AssemblePromptWithTools
orchestrator_test.cpp:102: Failure
Value of: db.AppendMessage("s1", "user", "Use the tool").ok()
  Actual: false
Expected: true

[  FAILED  ] OrchestratorTest.AssemblePromptWithTools (2 ms)
[ RUN      ] OrchestratorTest.AssembleOpenAIPrompt
orchestrator_test.cpp:123: Failure
Value of: db.AppendMessage("s1", "user", "Hello").ok()
  Actual: false
Expected: true

[  FAILED  ] OrchestratorTest.AssembleOpenAIPrompt (4 ms)
[ RUN      ] OrchestratorTest.ProcessOpenAIResponse
orchestrator_test.cpp:151: Failure
Value of: orchestrator.ProcessResponse("s1", mock_response).ok()
  Actual: false
Expected: true

[  FAILED  ] OrchestratorTest.ProcessOpenAIResponse (3 ms)
[ RUN      ] OrchestratorTest.ProcessOpenAIToolCall
orchestrator_test.cpp:179: Failure
Value of: orchestrator.ProcessResponse("s1", mock_response).ok()
  Actual: false
Expected: true

[  FAILED  ] OrchestratorTest.ProcessOpenAIToolCall (2 ms)
[ RUN      ] OrchestratorTest.GeminiHistoryNormalization
orchestrator_test.cpp:193: Failure
Value of: db.AppendMessage("s1", "user", "Part 1").ok()
  Actual: false
Expected: true

[  FAILED  ] OrchestratorTest.GeminiHistoryNormalization (0 ms)
[ RUN      ] OrchestratorTest.SkipsMalformedTools
orchestrator_test.cpp:220: Failure
Value of: db.AppendMessage("s1", "user", "Hello").ok()
  Actual: false
Expected: true

[  FAILED  ] OrchestratorTest.SkipsMalformedTools (0 ms)
[ RUN      ] OrchestratorTest.ParseToolCallGemini
[       OK ] OrchestratorTest.ParseToolCallGemini (2 ms)
[ RUN      ] OrchestratorTest.ParseToolCallOpenAI
[       OK ] OrchestratorTest.ParseToolCallOpenAI (0 ms)
[ RUN      ] OrchestratorTest.GcaPayloadWrapping
orchestrator_test.cpp:295: Failure
Value of: db.AppendMessage("s1", "user", "Hello").ok()
  Actual: false
Expected: true

[  FAILED  ] OrchestratorTest.GcaPayloadWrapping (1 ms)
[ RUN      ] OrchestratorTest.GcaResponseUnwrapping
orchestrator_test.cpp:323: Failure
Value of: orchestrator.ProcessResponse("s1", mock_gca_response).ok()
  Actual: false
Expected: true

[  FAILED  ] OrchestratorTest.GcaResponseUnwrapping (0 ms)
[ RUN      ] OrchestratorTest.ProcessResponseExtractsUsageGemini
orchestrator_test.cpp:343: Failure
Value of: orchestrator.ProcessResponse("s1", mock_response).ok()
  Actual: false
Expected: true

[  FAILED  ] OrchestratorTest.ProcessResponseExtractsUsageGemini (0 ms)
[ RUN      ] OrchestratorTest.ProcessResponseExtractsUsageOpenAI
orchestrator_test.cpp:364: Failure
Value of: orchestrator.ProcessResponse("s1", mock_response).ok()
  Actual: false
Expected: true

[  FAILED  ] OrchestratorTest.ProcessResponseExtractsUsageOpenAI (1 ms)
[ RUN      ] OrchestratorTest.SelfManagedStateTracking
orchestrator_test.cpp:387: Failure
Value of: orchestrator.ProcessResponse("s1", gemini_resp.dump()).ok()
  Actual: false
Expected: true

[  FAILED  ] OrchestratorTest.SelfManagedStateTracking (0 ms)
[ RUN      ] OrchestratorTest.AssemblePromptWithHeaders
orchestrator_test.cpp:409: Failure
Value of: db.AppendMessage("s1", "user", "Hello").ok()
  Actual: false
Expected: true

[  FAILED  ] OrchestratorTest.AssemblePromptWithHeaders (0 ms)
[ RUN      ] OrchestratorTest.AssembleOpenAIPromptWithHeaders
orchestrator_test.cpp:438: Failure
Value of: db.AppendMessage("s2", "user", "Hello").ok()
  Actual: false
Expected: true

[  FAILED  ] OrchestratorTest.AssembleOpenAIPromptWithHeaders (0 ms)
[ RUN      ] OrchestratorTest.AssemblePromptRollingWindow
orchestrator_test.cpp:467: Failure
Value of: db.AppendMessage("s1", "user", "msg1", "", "completed", "g1").ok()
  Actual: false
Expected: true

[  FAILED  ] OrchestratorTest.AssemblePromptRollingWindow (0 ms)
[ RUN      ] OrchestratorTest.RebuildContext
orchestrator_test.cpp:490: Failure
Value of: db.SetSessionState(sid, "Initial State").ok()
  Actual: false
Expected: true

[  FAILED  ] OrchestratorTest.RebuildContext (0 ms)
[----------] 21 tests from OrchestratorTest (40 ms total)

[----------] Global test environment tear-down
[==========] 21 tests from 1 test suite ran. (40 ms total)
[  PASSED  ] 2 tests.
[  FAILED  ] 19 tests, listed below:
[  FAILED  ] OrchestratorTest.AssemblePromptBasic
[  FAILED  ] OrchestratorTest.AssemblePromptWithSkills
[  FAILED  ] OrchestratorTest.ProcessResponsePersists
[  FAILED  ] OrchestratorTest.ProcessResponseToolCall
[  FAILED  ] OrchestratorTest.AssemblePromptWithTools
[  FAILED  ] OrchestratorTest.AssembleOpenAIPrompt
[  FAILED  ] OrchestratorTest.ProcessOpenAIResponse
[  FAILED  ] OrchestratorTest.ProcessOpenAIToolCall
[  FAILED  ] OrchestratorTest.GeminiHistoryNormalization
[  FAILED  ] OrchestratorTest.SkipsMalformedTools
[  FAILED  ] OrchestratorTest.GcaPayloadWrapping
[  FAILED  ] OrchestratorTest.GcaResponseUnwrapping
[  FAILED  ] OrchestratorTest.ProcessResponseExtractsUsageGemini
[  FAILED  ] OrchestratorTest.ProcessResponseExtractsUsageOpenAI
[  FAILED  ] OrchestratorTest.SelfManagedStateTracking
[  FAILED  ] OrchestratorTest.AssemblePromptWithHeaders
[  FAILED  ] OrchestratorTest.AssembleOpenAIPromptWithHeaders
[  FAILED  ] OrchestratorTest.AssemblePromptRollingWindow
[  FAILED  ] OrchestratorTest.RebuildContext

19 FAILED TESTS
================================================================================
INFO: From Testing //:command_handler_test:
==================== Test output for //:command_handler_test:
Running main() from gmock_main.cc
[==========] Running 11 tests from 1 test suite.
[----------] Global test environment set-up.
[----------] 11 tests from CommandHandlerTest
[ RUN      ] CommandHandlerTest.DetectsCommand
[       OK ] CommandHandlerTest.DetectsCommand (10 ms)
[ RUN      ] CommandHandlerTest.IgnoresNormalText
[       OK ] CommandHandlerTest.IgnoresNormalText (0 ms)
[ RUN      ] CommandHandlerTest.HandlesUnknownCommand
[       OK ] CommandHandlerTest.HandlesUnknownCommand (1 ms)
[ RUN      ] CommandHandlerTest.HandlesCommandWithWhitespace
[       OK ] CommandHandlerTest.HandlesCommandWithWhitespace (0 ms)
[ RUN      ] CommandHandlerTest.HandlesContextWindow
Rolling Window Context: Last 10 interaction groups.
command_handler_test.cpp:61: Failure
Expected equality of these values:
  settings->size
    Which is: 0
  10

[  FAILED  ] CommandHandlerTest.HandlesContextWindow (0 ms)
[ RUN      ] CommandHandlerTest.DetectsQuitExit
[       OK ] CommandHandlerTest.DetectsQuitExit (0 ms)
[ RUN      ] CommandHandlerTest.ActivatesSkillByName
Skill 'test_skill' activated.
[       OK ] CommandHandlerTest.ActivatesSkillByName (0 ms)
[ RUN      ] CommandHandlerTest.ActivatesSkillByNumericId
Skill '1' not found.
command_handler_test.cpp:102: Failure
Expected equality of these values:
  active_skills.size()
    Which is: 0
  1

[  FAILED  ] CommandHandlerTest.ActivatesSkillByNumericId (0 ms)
[ RUN      ] CommandHandlerTest.HandlesThrottle
Throttle set to: 5ms
Current throttle: 5ms
[       OK ] CommandHandlerTest.HandlesThrottle (0 ms)
[ RUN      ] CommandHandlerTest.HandlesUndo
command_handler_test.cpp:133: Failure
Value of: db.AppendMessage(sid, "user", "msg1", "", "completed", "g1").ok()
  Actual: false
Expected: true

[  FAILED  ] CommandHandlerTest.HandlesUndo (1 ms)
[ RUN      ] CommandHandlerTest.HandlesSessionRemove
command_handler_test.cpp:162: Failure
Value of: db.AppendMessage(sid, "user", "hello").ok()
  Actual: false
Expected: true

[  FAILED  ] CommandHandlerTest.HandlesSessionRemove (0 ms)
[----------] 11 tests from CommandHandlerTest (19 ms total)

[----------] Global test environment tear-down
[==========] 11 tests from 1 test suite ran. (19 ms total)
[  PASSED  ] 7 tests.
[  FAILED  ] 4 tests, listed below:
[  FAILED  ] CommandHandlerTest.HandlesContextWindow
[  FAILED  ] CommandHandlerTest.ActivatesSkillByNumericId
[  FAILED  ] CommandHandlerTest.HandlesUndo
[  FAILED  ] CommandHandlerTest.HandlesSessionRemove

 4 FAILED TESTS
================================================================================
FAIL: //:system_info_test (Exit 1) (see /private/var/tmp/_bazel_kailashs/99db4ea768af096d4b040886f889832a/execroot/_main/bazel-out/darwin_arm64-fastbuild/testlogs/system_info_test/test.log)
INFO: From Testing //:system_info_test:
==================== Test output for //:system_info_test:
Running main() from gmock_main.cc
[==========] Running 1 test from 1 test suite.
[----------] Global test environment set-up.
[----------] 1 test from SystemInfoTest
[ RUN      ] SystemInfoTest.BuiltinPromptIsLoaded
system_info_test.cpp:22: Failure
Value of: db.AppendMessage("s1", "user", "Hello").ok()
  Actual: false
Expected: true

[  FAILED  ] SystemInfoTest.BuiltinPromptIsLoaded (7 ms)
[----------] 1 test from SystemInfoTest (7 ms total)

[----------] Global test environment tear-down
[==========] 1 test from 1 test suite ran. (7 ms total)
[  PASSED  ] 0 tests.
[  FAILED  ] 1 test, listed below:
[  FAILED  ] SystemInfoTest.BuiltinPromptIsLoaded

 1 FAILED TEST
================================================================================
FAIL: //:tool_executor_test (Exit 1) (see /private/var/tmp/_bazel_kailashs/99db4ea768af096d4b040886f889832a/execroot/_main/bazel-out/darwin_arm64-fastbuild/testlogs/tool_executor_test/test.log)
INFO: From Testing //:tool_executor_test:
==================== Test output for //:tool_executor_test:
Running main() from gmock_main.cc
[==========] Running 7 tests from 1 test suite.
[----------] Global test environment set-up.
[----------] 7 tests from ToolExecutorTest
[ RUN      ] ToolExecutorTest.ReadWriteFile
[       OK ] ToolExecutorTest.ReadWriteFile (1 ms)
[ RUN      ] ToolExecutorTest.ExecuteBash
[       OK ] ToolExecutorTest.ExecuteBash (12 ms)
[ RUN      ] ToolExecutorTest.ToolNotFound
[       OK ] ToolExecutorTest.ToolNotFound (0 ms)
[ RUN      ] ToolExecutorTest.IndexAndSearch
fatal: not a git repository (or any of the parent directories): .git
[       OK ] ToolExecutorTest.IndexAndSearch (41 ms)
[ RUN      ] ToolExecutorTest.QueryDb
tool_executor_test.cpp:70: Failure
Value of: res->find("\"val\": 1") != std::string::npos
  Actual: false
Expected: true

[  FAILED  ] ToolExecutorTest.QueryDb (0 ms)
[ RUN      ] ToolExecutorTest.GrepToolWorks
fatal: not a git repository (or any of the parent directories): .git
[       OK ] ToolExecutorTest.GrepToolWorks (36 ms)
[ RUN      ] ToolExecutorTest.GitGrepToolWorks
fatal: not a git repository (or any of the parent directories): .git
[       OK ] ToolExecutorTest.GitGrepToolWorks (50 ms)
[----------] 7 tests from ToolExecutorTest (144 ms total)

[----------] Global test environment tear-down
[==========] 7 tests from 1 test suite ran. (144 ms total)
[  PASSED  ] 6 tests.
[  FAILED  ] 1 test, listed below:
[  FAILED  ] ToolExecutorTest.QueryDb

 1 FAILED TEST
================================================================================
INFO: Found 9 test targets...
INFO: Elapsed time: 0.434s, Critical Path: 0.34s
INFO: 7 processes: 3 action cache hit, 1 internal, 6 darwin-sandbox.
INFO: Build completed, 6 tests FAILED, 7 total actions
//:http_client_test                                             (cached) PASSED in 1.2s
//:oauth_handler_test                                           (cached) PASSED in 1.0s
//:ui_test                                                      (cached) PASSED in 0.7s
//:command_handler_test                                                  FAILED in 0.2s
  /private/var/tmp/_bazel_kailashs/99db4ea768af096d4b040886f889832a/execroot/_main/bazel-out/darwin_arm64-fastbuild/testlogs/command_handler_test/test.log
//:database_test                                                         FAILED in 0.2s
  /private/var/tmp/_bazel_kailashs/99db4ea768af096d4b040886f889832a/execroot/_main/bazel-out/darwin_arm64-fastbuild/testlogs/database_test/test.log
//:input_parsing_test                                                    FAILED in 0.2s
  /private/var/tmp/_bazel_kailashs/99db4ea768af096d4b040886f889832a/execroot/_main/bazel-out/darwin_arm64-fastbuild/testlogs/input_parsing_test/test.log
//:orchestrator_test                                                     FAILED in 0.2s
  /private/var/tmp/_bazel_kailashs/99db4ea768af096d4b040886f889832a/execroot/_main/bazel-out/darwin_arm64-fastbuild/testlogs/orchestrator_test/test.log
//:system_info_test                                                      FAILED in 0.2s
  /private/var/tmp/_bazel_kailashs/99db4ea768af096d4b040886f889832a/execroot/_main/bazel-out/darwin_arm64-fastbuild/testlogs/system_info_test/test.log
//:tool_executor_test                                                    FAILED in 0.3s
  /private/var/tmp/_bazel_kailashs/99db4ea768af096d4b040886f889832a/execroot/_main/bazel-out/darwin_arm64-fastbuild/testlogs/tool_executor_test/test.log

Executed 6 out of 9 tests: 3 tests pass and 6 fail locally.
There were tests whose specified size is too big. Use the --test_verbose_timeout_warnings command line option to see which ones these are.
